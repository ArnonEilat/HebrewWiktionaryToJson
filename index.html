<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport"    content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author"       content="">

		<link rel="stylesheet" href="js/jquery.tocify.js/jquery.tocify.css">
		<link rel="stylesheet" href="css/bootstrap-3.1.1-dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/jquery.qtip.min.css">
		<link rel="stylesheet" href="css/gh-fork-ribbon.css">
		<link rel="stylesheet" href="css/style.css">

	</head>

	<body>
		<div id="toc">
			<h1>תוכן ענינים</h1>
		</div>

		<div class="text-box">
			<h2>מבוא</h2>
			<p  class="indent">
				תכנה זאת עוסקת בחילוץ אוטומטי של נתונים מתוך <a href="http://he.wiktionary.org">ויקימילון</a>.
				<br>
				ויקימילון הנו פרויקט מילון רב לשוני שנועד לשימושים רבים. הוא מתנהל כפרויקט שיתופי, על בסיס אותם עקרונות של <a href="http://he.wikipedia.org/">ויקיפדיה</a>.
				<br>
				בהיבט של עיבוד נתונים - ערך בויקימילון מיוצג כטקסט יוניקוד(Unicode) פשוט(plain).
				<br>
				<a href="https://he.wiktionary.org/wiki/ויקימילון:מדריך_סגנון">הנחיות הייצוג</a> של <a href="http://he.wiktionary.org/wiki/ויקימילון:כתיבת_ערך_חדש">ערכים</a> ותכונותיהם בויקימילון מנסחות בפועל חוקי תחביר שעל עורכי המילון לציית להם. חוקים ותבניות אלה מאפשרים להתבונן בערכי המילון בהתבוננות שהיא &#39;מונחית אובייקטים&#39;. בהתבוננות כזאת - אפשר להשיג עיבוד נוח ויעיל של מבני קלט שכאלה.

				<br>
				התוצאה המצופה מעיבוד כזה היא הגדרת ממשק מול אובייקטים בעלי typeset מוגדר (בפועל – מול תת קבוצה נבחרת מתוך הסט המלא).
				<br>
				התכנה מבצעת פענוח, סינון וטרנספורמציה של ערכי ויקימילון לייצוג בבסיס נתונים בעל אינדקס מילוני מתאים לחיפוש ולשליפה.
				<br>
				מהלך העיבוד מבוסס על הפיכת התבניות הטקסטואליות מהייצוג התחבירי שלהן בויקימילון לאובייקטים בפורמט <a href="http://www.json.org/">JSON</a>.
			</p>
			<h3> מה אפשר לעשות עם זה?</h3>
			<div class="indent">
				ויקימילון הינו מקור עשיר ושימושי לצרכים רבים ומגוונים.
				<br>
				עם זאת - האפשרות לעשות בו שימוש ישיר באמצעים מתוכנתים היא מוגבלת מאד.
				<br>
				עיקר הקושי נובע – כאמור - מן הפער בין האופי הטקסטואלי החופשי והפתוח של ייצוגי ויקימילון לבין הדרישה למבניות - שהיא אבן יסוד לכל מהלך של עיבוד אוטומטי ממוחשב.
				למרות שהייצוג הפנימי של ערכי ויקימילון מוגדר בכללי תחביר – אין כל אמצעי או טכניקה לבקרה על הטקסטים שמוזנים על ידי עורכי המילון.
				יש אפוא הכרח לפתח אמצעי תוכנה שיאפשרו הפיכת ייצוג המבנים הפנימיים של ויקימילון לתבניות אובייקטים סטנדרטיות שתהיינה קריאות, זמינות, נגישות ונוחות לעיבוד ממוחשב.
			</div>

			<h2>תיאור המערכת</h2>
			<div class="indent">
				<h3>רקע</h3>
				<p class="indent">
					המידע של וויקי מילון נתון <span id="linkToFile" class="toolTip">בקובץ XML</span> שמכיל את ערכי המילון.
					<br>
					<span id="tp-wikimedia" class="toolTip">קרן וויקימדיה</span> משחררת עדכון לקובץ זה אחת לכמה זמן.
					<br>
					מכיוון שישנם ערכים שאינם תואמים לכללי הכתיבה במילון וגם מפני שישנם ערכים שהושחתו בזדון – תכנת העיבוד לא תעבוד על כל שחרור שיינתן לה. אולם בכתיבת התכנה הושם דגש רב על מיצוי מידע ככל שרק ניתן מבלי לרדת לטיפול במקרי קצה ספציפיים מדי לשחרור המעובד על ידה.
					משום כך יש להריץ את תכנת העיבוד כתסריט(script). כלומר כדי להפעיל את תכנת העיבוד על שחרור עתידי יש להבין את עקרונות הפעולה של התכנה. זאת מכיוון שיתכן מצב בו עורך של ערך יכתוב ערך ללא משמעות לסכמת האובייקט,  ואף יגרום להשחתה מכוונת.
					<br>
					קיצורו של דבר: רכיב תכנה זה מצפה לקלט תקני ועל מי שמפעיל אותו להיות ער לכך.
					<br>
					בתכנון המערכת הושם דגש על סקאלביליות (Scalability) ויכולת להתמודד עם שינויים עתידיים במבנה המסמכים. לעתים על חשבון מהירות העיבוד.
					<br>
					הרעיון המנחה בשימת דגש זו הוא ההבנה שמהירות העיבוד לא מהווה מדד לביצועים ולתפקוד ואילו פשטות התפעול, והקלות בה ניתן להכניס שינויים למערכת מהוות מדד לאיכות הביצוע של התכנה.
					<br>
					המערכת מבצעת מספר מעברים על מנת להשלים את מיצוי הקלט. זה נובע מהרצון לשמר ייצוג סטנדרטי בכל שלב מבלי לעשות קיצורי דרך ושימוש בייצוגים פרטניים.
				</p>
				<h4>רשימת מונחים</h4>

				<div class="indent">
					<table class="table table-hover">
						<thead>
							<tr>
								<th>מונח</th>
								<th>הסבר</th>
							</tr>
						</thead>
						<tr>
							<td>Page</td>
							<td>תג המסמן את יחידת העיבוד הבסיסית בקובץ ויקימילון.</td>
						</tr>
						<tr>
							<td>title</td>
							<td>תג המפתח שעל פיו יאתר הדפדפן את הדף המבוקש באתר ויקימילון. תג זה מוכל בתג page.</td>
						</tr>
						<tr>
							<td>מאמר</td>
							<td>ערך מילוני.</td>
						</tr>
						<tr>
							<td> כותרת</td>
							<td> טקסט המתאר תוכן מאמר המופיע בהמשכו.</td>
						</tr>
						<tr>
							<td>טבלת ניתוח דקדוקי </td>
							<td> טבלה המפרטת את הקטגוריות הדקדוקיות של ערך מילוני(פועל, הטיות, שם עצם)</td>
						</tr>
					</table>
				</div>

				<h3>תהליך העיבוד</h3>
				<p>
					תהליך העיבוד מורכב מהשלבים הבאים:
				</p>
				<ol>
					<li>
						קריאת הדף מקובץ הנתונים.
					</li>
					<li>
						חילוק הדף לכמה "מאמרים" לפי הכותרת.
					</li>
					<li>
						הסרת חלקים לא רלוונטיים מהמאמרים.
					</li>
					<li>
						הפיכת המאמרים לHTML
					</li>
					<li>
						חילוץ מידע מהDOM וכתיבת אובייקט JSON
					</li>
				</ol>

				<h4> 1. קריאת הדף מקובץ הנתונים. </h4>
				<div class="indent">
					נכון להיום, קובץ XML המכיל את נתונים וויקימילון תופס נפח של בין 25 ל30 מגה. לכן כדאי לעבד אותו בעיבוד סדרתי, כאשר בכל עיבוד רק החלק הרלוונטי לו נמצא בזיכרון.
					<br>
					יחידת העיבוד הקטנה ביותר שניתן לחלץ ממנה משמעות מילונית רחבה היא ה-page. ה-page מייצג מאמר באתר ויקימילון ובמבנה הפנימי של קובץ הXML הוא מיוצג על ידי התג page.
					<br>
					את תהליך קריאת הדף מקובץ הנתונים מבצעת המחלקה DatabaseFileBuilder, המחלקה קוראת את קובץ הXML שורה אחרי שורה. כאשר page שלם נקרא לתוך הזיכרון מתחיל תהליך עיבוד הדף:
					<br>
					אם הדף הוא מסוג הפניה(redirect) – כלומר הוא מפנה לערך אחר, נוצר מופע של המחלקה RedirectEntry. מופע זה מקבל את מבנה ה-DOM של המסמך ומאפשר להמירו לייצוג JSON.
					<br>
					לייצוג JSON של כניסת הפניה יש שני שדות מסוג מחרוזת:
					<ol>
						<li>
							title – כותרת ההפניה, מילה שממנה רוצים להפנות לערך אחר.
						</li>
						<li>
							where_to_redirect – הערך אליו רוצים להפנות.
						</li>
					</ol>
				</div>
				<p class="indent">
					אם הדף הוא מאמר(כלומר הוא לא הפניה אלא ערך מילוני לעצמו):
					<br>
					מתבצע סינון ראשוני של דפים(page) על פי כותרתם.
					כותרת הדף נמצאת בתגית title.
					<br>
					כאשר התגית מכילה את התו ':' הדף הוא בדרך כלל דף ללא מידע מילוני.
					<br>
					דוגמאות:
					<div class="ltr">
						&lt;title&gt;מדיה ויקי:Categories&lt;/title&gt;
						<br>
						&lt;title&gt;מדיה ויקי:Aboutpage&lt;/title&gt;
						<br>
						&lt;title&gt;מדיה ויקי:Edithelppage&lt;/title&gt;
					</div>
				</p>
				<p class="indent">
					אם הדף עבר את הסינון הראשוני, הוא מועבר לעיבוד כמאמרים (עיבוד המתואר בסעיפים 2-3)
					<br>
					דף שאינו ריק מוסב לפורמט JSON (מתואר בסעיף 5) ונכתב לקובץ הoutput בתור שכזה.
				</p>

				<h4> 2. חלוקת הדף לכמה "מאמרים" לפי הכותרת. </h4>
				<div class="indent">
					<h5>תיאור הבעיה</h5>
					<div class="indent">
						לכל דף של ויקימילון יש מפתח הנמצא בתגית title
						– להבדיל מכותרת.
						על פי רוב ה-title הוא בעברית, אולם ישנם מקרים בהם ה-title הוא באנגלית.
						<br>
						מטרת חלוקת הדף למאמרים היא לאפשר תרגום מאנגלית לעברית. זאת מכיוון שתרגומו של ערך לעברית מתבצע לפי המילה האנגלית.
						<br>
						נמחיש זאת בדוגמה:
						<br>
						הדף שה-title שלו "<a href="http://he.wiktionary.org/wiki/מלון">מלון</a>" יחולק ל3 מאמרים:
						<ol>
							<li>
								מאמר שתרגומו Hotel
							</li>
							<li>
								מאמר שתרגומו Melon‏‏‏‏
							</li>
							<li>
								מאמר שתרגומו Dictionary‏‏‏‏
							</li>
						</ol>
						מתקיים כאן קשר 1:M . למילה אחת בעברית אפשריים כמה פירושים שונים באנגלית.
						<br>
						כאשר נרצה לאחזר את הערך Hotel לא נרצה לקבל את המאמר שעוסק בMelon ואו Dictionary אולם כן נרצה לקבל את הערך "<a href="http://he.wiktionary.org/wiki/אשפיז">אֻשְׁפִּיז</a>" שגם בו מופיעה המחרוזת Hotel כתרגום (אושפיז בלשון חז"ל: מלון).
					</div>
					<h5> חלוקת הדף למאמרים </h5>
					<div class="indent">
						כותרת המאמר מייצגת את הערך שמתואר מתחתיה.
						<br>
						הכותרות של המאמרים בויקימילון, ורק הן, אמורות להיות עטופות בתג H2 או בסימונו הוויקי ==
						<br>
						על כן, הדפים מחולקים למאמרים לפי תגים אלו.
						<br>
						אולם, מכיוון שישנם כותבים שלא מקפידים על כללי הכתיבה, תהליך החלוקה מתעלם מכותרות בעלות ערכים שמסמנים שדות אחרים במאמר מילוני, כמו לדוגמה- כותרות לא מוקפדות כלהלן:
						<br>
						קישורים חיצוניים – שיצוגו הפנימי הוא ==קישורים חיצוניים==
						<br>
						הערות שוליים, כנ"ל.
						<br>
						חלוקת הדף למאמרים נעשית על ידי המתודה getArticles שבמחלקה Article.
					</div>
				</div>

				<h4> 3. הסרת חלקים לא רלוונטיים מהמאמרים ועיבוד ראשוני </h4>
				<div class="indent">
					<h5>יצירת מאמר</h5>
					<div  class="indent">
						מאמר נוצר עם כותרת ותוכן טקסטואלי בפורמט וויקי.
						<br>
						בשלב הראשון מנסים לחלץ מהטקסט "ניתוח דקדוקי". זאת היא טבלה שמסווגת קטגוריות דקדוקיות של הערך המילוני(פועל, שם עצם וכו').
						<br>
						לאחר מכן (אם צריך בכלל לעבד את המאמר) מסירים ממנו חלקים שאינם רלוונטיים, מזהים בו תבניות מוכרות ומסבים אותו לHTML (הסבת המאמר לHTML מתוארת בסעיף 4).
					</div>
				</div>
				<div  class="indent">
					<h5> חילוץ של "ניתוח דקדוקי" </h5>
					<p class="indent">
						הרכיב שהופך מתחביר wiki לHTML אינו תומך בטבלאות. "גוש" <a href="http://he.wiktionary.org/wiki/ויקימילון:איך_לכתוב_ניתוח_דקדוקי">הניתוח הדקדוקי</a> מופיע במבנה של טבלה. מכיוון שהוא חלק חשוב בערך מילוני יש לחלצו מייצוגו כטבלה ולעבדו. זהו המופע היחיד של טבלת wiki שנתמך בפרויקט.
						<br>
						חילוץ ערכי הטבלה נעשה על ידי פיצולה לפי שורות, הוצאת ערכים מעמודת הערכים ושיוכם למאפיין (property) המתאים לפי שורת ההסבר.
						<br>
						במידה ומאפיין (property) לא מופיע, אובייקט הJSON שמייצג את הניתוח הדקדוקי לא יכלול את אותו המאפיין.
					</p>
				</div>

				<h4> 4. הפיכת המאמרים לHTML </h4>
				<div class="indent">
					המרת הטקסט למבנה HTML נעזרת בביטויים רגולריים על קלט הוויקי והסבתם לייצוגים המקבילים להם בפורמט HTML.
					<br>
					תבניות הייצוג של וויקי שאין להם מקבילות בHTML מוסבות למאפיינים (attributes) פנימיים של אלמנטי HTML כדי שיהיה אפשר לטפל בהם בהמשך העיבוד.
					<br>
					לדוגמה:
					<table class="table table-bordered table-condensed align-middle">
						<colgroup>
							<col span="1" style="width: 20%;">
							<col span="1" style="width: 30%;">
							<col span="1" style="width: 50%;">
						</colgroup>
						<thead>
							<tr>
								<th>תבנית וויקי</th>
								<th>סוג</th>
								<th>HTML</th>
							</tr>
						<thead>
							<tr>
								<td>==word==</td>
								<td rowspan="2"> הסבה ישירה מWIKI לHTML </td>
								<td class="ltr">&lt;h2&gt;word&lt;/h2&gt;</td>
							</tr>
							<tr>
								<td>'''Bold Text'''</td>
								<td class="ltr">&lt;b&gt;Bold Text&lt;/b&gt;</td>
							</tr>
							<tr>
								<td>{{ת|אנגלית|Hotel}}</td>
								<td rowspan="2"> הצבת סמן לעיבוד בהמשך </td>
								<td class="ltr">&lt;span class="translation" data-destinationLanguage="אנגלית"&gt;Hotel&lt;/span&gt;</td>
							</tr>
							<tr>
								<td>{{משלב|ביולוגיה}}</td>
								<td class="ltr">&lt;span class="linguisticRegister"&gt;[אקולוגיה]&lt;/span&gt;</td>
							</tr>
					</table>
					רשימת תבניות הוויקי הנתמכות מופיעה <a href="syntax.html">כאן</a>.
					היא זאת אשר מגדירה את טווח האפשרויות שהפרויקט יכול להגיע אליהן.
					בפועל השליפה מתבצעת רק על סט מצומצם מתוכן.
				</div>

				<h4> 5. חילוץ מידע מהDOM וכתיבת אובייקט JSON </h4>
				<div class="indent">
					לאחר השלמת השלבים שתוארו לעיל ניתן לייצג DOM.
					<br>
					הייצוג נעשה בעזרת הספרייה <a href="http://jsoup.org/">jSoup</a>.
					<br>
					חילוץ המידע מתבסס על המבנה הקבוע של ערך בויקימילון, במידה והערך אינו במבנה הקבוע של ערך מילוני נעשית התאמה אופטימלית לגשר על פער הייצוג.
					<br>
					לדוגמה: אם לא נמצא תג צפוי H2 בתחילת הערך מצפים ומחפשים H3.
					<br>
					חילוץ המידע נעשה על בסיס תתי הכותרות שמיוצגות על ידי התג H3. מתחת לכל מופע של תג זה אמור להופיע מידע רלוונטי למופע התג. לדוגמה: מתחת לתג H3 שתוכנו "גיזרון" אמור להופיע תוכן הגיזרון.
					<br>
					המידע שחולץ מוצב באובייקט JSON.
					מבנה מלא של אובייקט
					JSON מתואר <a href="json.html">כאן</a>.
				</div>
			</div>
			<h2>איך מריצים</h2>
			<div class="indent">
				<h3>הוראות לubuntu</h3>
				<pre class="ltr"><span class="unselectable">$</span> git clone git@github.com:ArnonEilat/HebrewWiktionaryToJson.git</pre>
				<pre class="ltr"><span class="unselectable">$</span> ant -f /Path/To/HebrewWiktionaryToJson/nbproject/build-impl.xml -Dnb.internal.action.name=rebuild clean jar</pre>
				<pre class="ltr"><span class="unselectable">$</span> java -jar dist/Database_File_Builder.jar</pre>
				אפשר גם פשוט לפתוח את התקיה כפרויקט של&nbsp;<a href="https://netbeans.org/">NetBeans</a>.

				<h3>הוראות לwindows</h3>
				ההרצה אמורה לעבוד כמו בubuntu.
			</div>
			<h2>איך אפשר לעזור</h2>
			<div class="indent">
				יש לא מעט TODOs בתוך הקוד, וחלקם ממש קלים.
				<br>
				אפשר למצוא אותם בעזרת הרצת הפקודה
				<code style="direction: ltr;display: inline-block;">
					grep -Ril &#39;todo&#39; ./
				</code>
				מתוך ספריית הפרוייקט.
			</div>
		</div>
		</div>
		</div>

		<div class="github-fork-ribbon-wrapper left-bottom">
			<div class="github-fork-ribbon">
				<a href="https://github.com/ArnonEilat/HebrewWiktionaryToJson/">Fork me on GitHub</a>
			</div>
		</div>
		<script type="application/javascript" src="js/jquery.min.js"></script>
		<script type="application/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
		<script type="application/javascript" src="css/bootstrap-3.1.1-dist/js/bootstrap.min.js"></script>
		<script type="application/javascript" src="js/jquery.tocify.js/jquery.tocify.min.js"></script>
		<script type="application/javascript" src="js/jquery.qtip.min.js"></script>

		<script type="application/javascript" src="js/script.js"></script>
	</body>
</html>

